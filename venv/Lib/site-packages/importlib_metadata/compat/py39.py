"""
Compatibility layer with Python 3.8/3.9
"""

<<<<<<< HEAD
from typing import TYPE_CHECKING, Any, Optional
=======
from __future__ import annotations

from typing import TYPE_CHECKING, Any
>>>>>>> dev

if TYPE_CHECKING:  # pragma: no cover
    # Prevent circular imports on runtime.
    from .. import Distribution, EntryPoint
else:
    Distribution = EntryPoint = Any

<<<<<<< HEAD

def normalized_name(dist: Distribution) -> Optional[str]:
=======
from .._typing import md_none


def normalized_name(dist: Distribution) -> str | None:
>>>>>>> dev
    """
    Honor name normalization for distributions that don't provide ``_normalized_name``.
    """
    try:
        return dist._normalized_name
    except AttributeError:
        from .. import Prepared  # -> delay to prevent circular imports.

<<<<<<< HEAD
        return Prepared.normalize(getattr(dist, "name", None) or dist.metadata['Name'])
=======
        return Prepared.normalize(
            getattr(dist, "name", None) or md_none(dist.metadata)['Name']
        )
>>>>>>> dev


def ep_matches(ep: EntryPoint, **params) -> bool:
    """
    Workaround for ``EntryPoint`` objects without the ``matches`` method.
    """
    try:
        return ep.matches(**params)
    except AttributeError:
        from .. import EntryPoint  # -> delay to prevent circular imports.

        # Reconstruct the EntryPoint object to make sure it is compatible.
        return EntryPoint(ep.name, ep.value, ep.group).matches(**params)
